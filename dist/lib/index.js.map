{"version":3,"sources":["lib/index.js"],"names":[],"mappings":"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","file":"lib/index.js","sourcesContent":["const ebArgs = require('commander');\nconst ElasticBeanstalk = require('elastic-beanstalk.js');\n\nconst utils = require('./utils');\n\nconst ebDeploy = require('root-require')('./package.json');\nconst version = ebDeploy.version;\n\nconst path = require('path');\n\n// Set up command line args\nebArgs\n  .version(version)\n  .option('-a, --accessKeyId <key>', 'Set AWS Access Key')\n  .option('-s, --secretAccessKey <key>', 'Set AWS Secret Access Key')\n  .option('-r, --region <region>', 'Set AWS Region [eu-west-1]', 'eu-west-1')\n  .option('-A, --applicationName <name>', 'The name of your Elastic Beanstalk Application')\n  .option('-e, --environment <name>', 'Which environment should this application be deployed to?')\n  .option('-b, --bucketName <name>', 'The name of the *existing* S3 bucket to store your version')\n  .option('-B, --branch <name>', 'The branch that should be used to generate the archive [master]', 'master')\n  .option('-V, --packageVersionOrigin <version>', 'Whether to use the version from package.json, or git tag [package.json]', 'package.json')\n  .parse(process.argv);\n\n// Check arguments\n// Back out if we've not set the required keys\nif(!ebArgs.accessKeyId) {\n  console.error('AWS Access Key must be set!');\n  process.exit(1);\n}\n\nif(!ebArgs.secretAccessKey) {\n  console.error('AWS Secret Access Key must be set!');\n  process.exit(1);\n}\n\nif(!ebArgs.applicationName) {\n  console.error('Application name must be set!');\n  process.exit(1);\n}\n\nif(!ebArgs.environment) {\n  console.error('EB Environment must be set!');\n  process.exit(1);\n}\n\nif(!ebArgs.bucketName) {\n  console.error('EB Bucket Name must be set!');\n  process.exit(1);\n}\n\n// All projects require a package.json\ntry {\n  console.log('Attempting to load package.json: %s', path.join(process.cwd(), 'package.json'));\n  var packageInfo = require(path.join(process.cwd(), 'package.json'));\n}\ncatch(e) {\n  console.error('No package.json found, exiting');\n  console.error(e);\n  process.exit(1);\n}\n\nconst project = {\n  name: (ebArgs.applicationName || packageInfo.name || 'my-app')\n};\n\n// Create the Elastic Beanstalk client\nconst elasticBeanstalk = new ElasticBeanstalk({\n  aws: {\n    accessKeyId: ebArgs.accessKeyId,\n    secretAccessKey: ebArgs.secretAccessKey,\n    region: ebArgs.region || 'eu-west-1',\n    applicationName: ebArgs.applicationName || 'my-app',\n    versionsBucket: ebArgs.bucketName || 'mubaloo-ecs-config'\n  }\n});\n\n// Create the archive\nutils.makeVersionsFolder()\n  .then(function() {\n    return utils.getGitTag()\n  })\n  .then(function(tag) {\n    project.version = (ebArgs.packageVersionOrigin == 'package.json' ? packageInfo.version : tag);\n    console.log('Project version @' + project.version);\n    return utils.createArchive(ebArgs.branch, project.version);\n  })\n  .then(function() {\n    return elasticBeanstalk.createVersionAndDeploy({\n      environment: ebArgs.environment,\n      filename: path.join(process.cwd(), 'release.' + project.version + '.zip'),\n      remoteFilename: project.name + '_' + project.version + '.zip',\n      versionLabel: project.version\n    });\n  })\n  .then(function() {\n    console.log('Successfully deployed ' + project.name + ' (' + project.version + ') to EB');\n  })\n  .fail(function(error) {\n    console.error(error);\n    process.exit(1);\n  })\n"],"sourceRoot":"/source/"}